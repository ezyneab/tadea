
<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>Tadea v18</title>
  <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
  <style>
    body { font-family: Arial, sans-serif; margin: 20px; background: #f5f5f5; }
    input, select { padding: 5px; margin: 5px; }
    table { width: 100%; border-collapse: collapse; margin-top: 20px; }
    th, td { border: 1px solid #ccc; padding: 5px; text-align: center; }
    th { background: #eee; }
  </style>
</head>
<body>
  <h2>Tadea v18 - Trade Logger</h2>
  <label>Balance: <input id="balanceInput" type="number" value="10000"></label>
  <label>Risk %: <input id="riskInput" type="number" value="1"></label>
  <label>RR: <input id="rrInput" type="number" value="1.5"></label>
  <label>System Tag: <input id="tagInput" type="text" placeholder="e.g. Donchian"></label>
  <button onclick="addTrade('win')">Win</button>
  <button onclick="addTrade('loss')">Loss</button>
  <br><br>
  <label>Filter by Tag:
    <select id="filterTag" onchange="renderTable()">
      <option value="all">All</option>
    </select>
  </label>

  <table>
    <thead>
      <tr>
        <th>#</th><th>System</th><th>Risk %</th><th>RR</th><th>Result</th><th>PnL ($)</th><th>Equity ($)</th>
      </tr>
    </thead>
    <tbody id="tradeTableBody"></tbody>
  </table>

  <h3>Summary</h3>
  <p>Total Trades: <span id="totalTrades">0</span></p>
  <p>Win / Loss: <span id="winLoss">0 / 0</span></p>
  <p>Winrate: <span id="winrate">0%</span></p>
  <p>Total PnL: <span id="totalPnl">$0.00 (0.00%)</span></p>

  <canvas id="equityChart" height="100" style="margin-top: 30px;"></canvas>

  <script>
    let trades = [];
    let equityChart;

    function formatNumber(num) {
      return num.toLocaleString(undefined, {minimumFractionDigits: 2, maximumFractionDigits: 2});
    }

    function updateTagFilterOptions() {
      const tags = [...new Set(trades.map(t => t.tag))];
      const filter = document.getElementById("filterTag");
      filter.innerHTML = '<option value="all">All</option>';
      tags.forEach(tag => {
        const opt = document.createElement("option");
        opt.value = tag;
        opt.textContent = tag;
        filter.appendChild(opt);
      });
    }

    function addTrade(result) {
      const balance = parseFloat(document.getElementById("balanceInput").value);
      const riskPercent = parseFloat(document.getElementById("riskInput").value);
      const rr = parseFloat(document.getElementById("rrInput").value);
      const tag = document.getElementById("tagInput").value.trim() || "Untagged";
      const lastEquity = trades.length ? trades[trades.length - 1].equity : balance;
      const riskAmount = (riskPercent / 100) * lastEquity;
      const pnl = result === "win" ? riskAmount * rr : -riskAmount;
      const newEquity = lastEquity + pnl;

      trades.push({ rr, risk: riskPercent, result, pnl, equity: newEquity, tag });
      updateTagFilterOptions();
      renderTable();
    }

    function updateEquityChart(filteredTrades) {
      const labels = filteredTrades.map((_, i) => i + 1);
      const data = filteredTrades.map(t => t.equity);
      const ctx = document.getElementById("equityChart").getContext("2d");

      if (equityChart) equityChart.destroy();

      equityChart = new Chart(ctx, {
        type: "line",
        data: {
          labels: labels,
          datasets: [{
            label: "Equity Curve",
            data: data,
            fill: false,
            borderColor: "rgb(75, 192, 192)",
            tension: 0.3
          }]
        },
        options: {
          responsive: true,
          scales: {
            x: { display: true, title: { display: true, text: "Trade #" }},
            y: { display: true, title: { display: true, text: "Equity ($)" }}
          }
        }
      });
    }

    function renderTable() {
      const tableBody = document.getElementById("tradeTableBody");
      const selectedTag = document.getElementById("filterTag").value;
      tableBody.innerHTML = "";
      let wins = 0, losses = 0, totalPnL = 0;
      let displayTrades = selectedTag === "all" ? trades : trades.filter(t => t.tag === selectedTag);

      displayTrades.forEach((trade, index) => {
        const row = document.createElement("tr");
        row.innerHTML = `
          <td>${index + 1}</td>
          <td>${trade.tag}</td>
          <td>${trade.risk}</td>
          <td>${trade.rr}</td>
          <td>${trade.result}</td>
          <td>$${formatNumber(trade.pnl)}</td>
          <td>$${formatNumber(trade.equity)}</td>`;
        tableBody.appendChild(row);
        if (trade.result === "win") wins++;
        if (trade.result === "loss") losses++;
        totalPnL += trade.pnl;
      });

      const total = wins + losses;
      const winrate = total > 0 ? (wins / total) * 100 : 0;
      document.getElementById("totalTrades").textContent = total;
      document.getElementById("winLoss").textContent = `${wins} / ${losses}`;
      document.getElementById("winrate").textContent = `${winrate.toFixed(2)}%`;

      const startBalance = parseFloat(document.getElementById("balanceInput").value);
      const percentPnL = (totalPnL / startBalance) * 100;
      document.getElementById("totalPnl").textContent = `$${formatNumber(totalPnL)} (${formatNumber(percentPnL)}%)`;

      updateEquityChart(displayTrades);
    }
  </script>
</body>
</html>
